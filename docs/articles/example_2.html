<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>SEM with Multiple Latent Variables, in 4 Fragments • muppet</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.7/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.0/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.0/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="SEM with Multiple Latent Variables, in 4 Fragments">
<style>
.pkgdown-footer-left { display: none; }
</style>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">muppet</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Examples and Tips</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>SEM with Multiple Latent Variables, in 4 Fragments</h1>
            
            <h4 data-toc-skip class="date">2025-08-28</h4>
      

      <div class="d-none name"><code>example_2.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This example demonstrates how to use the muppet() package to perform
MUPPET modeling for a structural equation modeling (SEM) example. This
example has 4 fragments. Fragment 1 is the measurement model for 3
latent variables. Fragment 2 defines a measurement model for 2 other
latent variables. Fragment 3 then adds to the measurement model in
Fragment 2, by adding some indicators to one of the latent variables.
Fragment 4 is a structural model relating the latent variables from
Fragment 1 to the latent variables in Fragment 3 (and 2).</p>
</div>
<div class="section level2">
<h2 id="data-prepration">Data Prepration<a class="anchor" aria-label="anchor" href="#data-prepration"></a>
</h2>
<p>Load the package and extract the data for this example.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://roy-levy.github.io/muppet_pub/">muppet</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sim.POWER</span>, package <span class="op">=</span> <span class="st">"muppet"</span><span class="op">)</span></span>
<span><span class="va">data.for.mplus</span> <span class="op">&lt;-</span> <span class="va">sim.POWER.data</span></span></code></pre></div>
<p>Look through the data and check if any of the column names have more
than 8 characters. Owing to Mplus’s naming conventions for parameters,
variable names should be 8 characters or fewer. For variables that are
discrete (categorical), the length of the names should be 6 characters
or fewer. (This holds as long as there are fewer than 10 thresholds for
the categorical variables. If you’re using a variable with 10 or more
thresholds, you will likely need an even shorter variable name.)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># * Check if any column names are more than 8 characters</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data.for.mplus</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Do not proceed. Rename Mplus variables to have &lt;= 8 characters"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"See Permissive Norms Example R file for code on renaming variables"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="specify-fragment-1">Specify Fragment 1<a class="anchor" aria-label="anchor" href="#specify-fragment-1"></a>
</h2>
<p>The key specification for Fragment 1 is the Mplus syntax for the
factor analytic measurement model. In this specification, there are 3
latent variables. All the latent variable means and variances are fixed,
and all the loadings and intercepts are estimated.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Mplus.MODEL.syntax.fragment.1</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">  ! Working Memory Factor Model</span></span>
<span><span class="st">  ! Central Executive</span></span>
<span><span class="st">  CE BY NBAA* NBVA CeNmUp_I;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Focus of Attention</span></span>
<span><span class="st">  FOA BY VsSpnR_I* LcSpnR_I VsSpnW_I LcSpnW_I BndVBW BndCmBW DgSpnR_I BndPBSW;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Phonological Storage Rehearsal</span></span>
<span><span class="st">  PSR BY BndCmBW* DgSpnR_I BndPBSW DgSpnW_I PlNWWW;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Factor Variances</span></span>
<span><span class="st">  CE@1;</span></span>
<span><span class="st">  FOA@1;</span></span>
<span><span class="st">  PSR@1;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Factor Correlations</span></span>
<span><span class="st">  CE WITH FOA PSR;</span></span>
<span><span class="st">  FOA WITH PSR;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Factor Means</span></span>
<span><span class="st">  [CE@0];</span></span>
<span><span class="st">  [FOA@0];</span></span>
<span><span class="st">  [PSR@0];</span></span>
<span><span class="st">  "</span></span></code></pre></div>
<p>Now define the specifications for the fragment. In this list we are
passing along the syntax and data from above.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fragment.1.specs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Working Memory Measurement Model"</span>,</span>
<span>  model.syntax <span class="op">=</span> <span class="va">Mplus.MODEL.syntax.fragment.1</span>,</span>
<span>  conditioning <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data.for.mplus</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="specify-fragment-2">Specify Fragment 2<a class="anchor" aria-label="anchor" href="#specify-fragment-2"></a>
</h2>
<p>Fragment 2 is a factor analytic measurement model, similar to
Fragment 1. Here again, the key specification is the Mplus syntax for
the factor analytic measurement model, where as above, the means and
variances for the (2) latent variables are fixed, and the loadings and
intercepts are estimated.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Mplus.MODEL.syntax.fragment.2</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">    ! Word Learning Factor Model</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Phonological</span></span>
<span><span class="st">  PHON BY</span></span>
<span><span class="st">  ICPVL1gm* ICPVL2gm DIPVL1gm DIPVL2gm</span></span>
<span><span class="st">  SIPVL1gm SIPVL2gm LTPVL1gm LTPVL2gm ICNT2P ICNT1P</span></span>
<span><span class="st">  DINT1P DINT2P PINTGM</span></span>
<span><span class="st">  PIPVLgm;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Semantic</span></span>
<span><span class="st">  SEM BY ICVDD2ap* SIVDD1ap SIVDD2ap PIVDD0ap PIVFRgmp</span></span>
<span><span class="st">  ICVDD1ap SIVFR1gm SIVFR2gm LTVFR1gm LTVFR2gm;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Factor Variances</span></span>
<span><span class="st">  PHON@1;</span></span>
<span><span class="st">  SEM@1;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Factor Correlations</span></span>
<span><span class="st">  PHON WITH SEM;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Factor Means</span></span>
<span><span class="st">  [PHON@0];</span></span>
<span><span class="st">  [SEM@0];</span></span>
<span><span class="st">  "</span></span></code></pre></div>
<p>Now define the specifications for the fragment. In this list we are
passing along the syntax and data from above. Note that even though this
is Fragment 2, it is not conditional on Fragment 1. This is expressed by
the argument that <code>conditioning = 0</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fragment.2.specs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Word Learning Measurement Model"</span>,</span>
<span>  model.syntax <span class="op">=</span> <span class="va">Mplus.MODEL.syntax.fragment.2</span>,</span>
<span>  conditioning <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data.for.mplus</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="specify-fragment-3">Specify Fragment 3<a class="anchor" aria-label="anchor" href="#specify-fragment-3"></a>
</h2>
<p>Fragment 3 is conditional on Fragment 2, and adds to it by including
additional variables as indicators for one of the latent variables. Note
that the syntax here also includes the specifications fixing the latent
variable means and variances. These were included in Fragment 1 as well,
but also need to be here to preserve this constraint. In effect, the
function will bring in the results for the <em>fitted</em> parameters
from Fragment 2. But the latent variable means and variances were not
fitted parameters in Fragment 2. They were fixed in Fragment 2. So they
will not be “brought forward” by looking at the fitted results from
Fragment 2. So they need to be specified here as well.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Mplus.MODEL.syntax.fragment.3</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">  ! Word Learning Factor Model</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Phonological</span></span>
<span><span class="st">  PHON BY PIMD0ap* ICMD2ap ICMD1ap DIMD1ap  DIMD2ap;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Factor Variances</span></span>
<span><span class="st">  PHON@1;</span></span>
<span><span class="st">  SEM@1;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Factor Means</span></span>
<span><span class="st">  [PHON@0];</span></span>
<span><span class="st">  [SEM@0];</span></span>
<span><span class="st">  "</span></span></code></pre></div>
<p>Now define the specifications for the fragment. In this list we are
passing along the syntax and data, as we did for other fragments. By
setting <code>conditioning = 2</code> in this list of specifications, we
are instructing the functions to condition on the results from Fragment
2.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fragment.3.specs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Including More Word Learning Indicators"</span>,</span>
<span>  model.syntax <span class="op">=</span> <span class="va">Mplus.MODEL.syntax.fragment.3</span>,</span>
<span>  conditioning <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data.for.mplus</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="specify-fragment-4">Specify Fragment 4<a class="anchor" aria-label="anchor" href="#specify-fragment-4"></a>
</h2>
<p>Fragment 4 contains the structural portion relating the latent
variables from Fragment 1 to those in Fragment 3 (which were also a part
of Fragment 2). The latent variables from Fragment 1 are were exogenous
in that fragment, and remain so here. Accordingly, in the Mplus syntax
their factor means and variances are fixed, as they were in Fragment 1.
In contrast, the latent variables from Fragment 3 were exogenous in
Fragment 3, but are now endogenous (being predicted by the latent
variables from Fragment 1). Accordingly, Even though their means and
variances were fixed in Fragment 3, those parameters are now functions
of other parameters, and we estimate intercepts and latent disturbance
variances for those latent variables as part of the structural model.
Note also that the correlation between the latent disturbances is part
of the fitted model here. This is for the same reason.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Mplus.MODEL.syntax.fragment.4</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Structural relations</span></span>
<span><span class="st">  PHON ON CE FOA PSR;</span></span>
<span><span class="st">  SEM ON CE FOA PSR;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Structural intercepts</span></span>
<span><span class="st">  [PHON];</span></span>
<span><span class="st">  [SEM];</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Latent correlations (disturbances)</span></span>
<span><span class="st">  PHON WITH SEM;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Factor Variances</span></span>
<span><span class="st">  CE@1;</span></span>
<span><span class="st">  FOA@1;</span></span>
<span><span class="st">  PSR@1;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Factor Means</span></span>
<span><span class="st">  [CE@0];</span></span>
<span><span class="st">  [FOA@0];</span></span>
<span><span class="st">  [PSR@0];</span></span>
<span><span class="st">  "</span></span></code></pre></div>
<p>Now define the specifications for the fragment. The first key element
here is <code>conditioning = c(1,2,3)</code>. This communicates that
Fragment 4 is conditional on Fragments 1, 2, and 3. The next key element
here is <code>parameters.to.exclude.in.conditioning</code>. This is a
list with 3 entries, corresponding to the 3 fragments that we are
conditioning on. The entries in the list express which parameters from
that antecedent fragment to ignore (i.e., not carry forward to Fragment
4). In this example, we want to carry forward all the fitted parameters
from Fragment 1, so the first element in the list is <code>none</code>.
But we do want to ignore some of the fitted parameters from Fragment 2
and 3. In particular, we want to ignore the fitted covariances among the
latent variables in those fragments, because those fragments are now
endogenous, and we wish to estimate their latent disturbance covariance,
as mentioned above. .</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fragment.4.specs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Working Memory Predict Word Learning"</span>,</span>
<span>  model.syntax <span class="op">=</span> <span class="va">Mplus.MODEL.syntax.fragment.4</span>,</span>
<span>  conditioning <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>  parameters.to.exclude.in.conditioning <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># fragment 1</span></span>
<span>    <span class="st">"none"</span>,</span>
<span></span>
<span>    <span class="co"># fragment 2</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(co)variances of latent variables"</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="co"># fragment 3</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(co)variances of latent variables"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data.for.mplus</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conduct-muppet-modeling">Conduct MUPPET modeling<a class="anchor" aria-label="anchor" href="#conduct-muppet-modeling"></a>
</h2>
<p>The code below demonstrates conducting MUPPET modeling. The
<code>fragments</code> argument contains the specifications for the
model fragments defined above. The rest of the arguments communicate
specifications for running MCMC and saving output. Running this code
will write out output files.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/MUPPET.modular.html">MUPPET.modular</a></span><span class="op">(</span></span>
<span>  fragments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fragment.1.specs</span>, <span class="va">fragment.2.specs</span>, <span class="va">fragment.3.specs</span>, <span class="va">fragment.4.specs</span><span class="op">)</span>,</span>
<span>  n.chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n.warmup <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  n.burnin <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  n.iters.per.chain.after.warmup.and.burnin <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n.estimation.batches <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  convergence.assessment <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  save.summary.plots.from.MUPPET <span class="op">=</span> <span class="st">"none"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Roy Levy.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
