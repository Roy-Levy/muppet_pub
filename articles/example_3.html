<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IRT Calibration, In-Sample Scoring, &amp; Out-Of-Sample Scoring, in 3 Fragments • muppet</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="IRT Calibration, In-Sample Scoring, &amp; Out-Of-Sample Scoring, in 3 Fragments">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">muppet</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/index.html">Examples and Tips</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>IRT Calibration, In-Sample Scoring, &amp;
Out-Of-Sample Scoring, in 3 Fragments</h1>
            
            <h4 data-toc-skip class="date">2025-08-29</h4>
      

      <div class="hidden name"><code>example_3.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This example demonstrates how to use the muppet() package to perform
MUPPET modeling for an item response theory (IRT) example. The example
has 3 fragments. In Fragment 1 (calibration), the measurement model is
fit to a set of item responses for 10 items from a sample of examinees
(referred to as Sample A). Fitting this fragment yields estimated
measurement model (i.e., item) parameters. In Fragment 2, the results
from Fragment 1 are used to estimate latent variable values for the
examinees from this same dataset, Sample A (i.e., conduct in-sample
scoring). In Fragment 3, the results from Fragment 1 are used to
estimate latent variable values of for a different set of examinees
(Sample B) whose data were not part of the calibration process (i.e.,
conduct out-of-sample scoring).</p>
</div>
<div class="section level2">
<h2 id="data-prepration">Data Prepration<a class="anchor" aria-label="anchor" href="#data-prepration"></a>
</h2>
<p>Load the package and extract the data for this example.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">muppet</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sim.IRT</span>, package <span class="op">=</span> <span class="st">"muppet"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="specify-fragment-1">Specify Fragment 1<a class="anchor" aria-label="anchor" href="#specify-fragment-1"></a>
</h2>
<p>Fragment 1 fits an IRT model to item responses to 10 items. One key
specification for Fragment 1 is the Mplus syntax for the IRT measurement
model. In this specification the latent variable is modeled as having a
fixed mean and variance. All the loadings (discriminations) and location
parameters are estimated.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Mplus.MODEL.syntax.fragment.1</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">  F1 by It1-It10*;</span></span>
<span><span class="st">  [It1$1-It10$1];</span></span>
<span><span class="st">  F1@1;</span></span>
<span><span class="st">  [F1@0];</span></span>
<span><span class="st">"</span></span></code></pre></div>
<p>As the observed variables are discrete (categorical), we will need to
specify them as such for the Mplus VARIABLE command. To do so, define an
R object with the desired text for the Mplus input file.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Mplus.VARIABLE.syntax.fragment.1</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">     CATEGORICAL =</span></span>
<span><span class="st">        It1-It10</span></span>
<span><span class="st">    ;</span></span>
<span><span class="st">  "</span></span></code></pre></div>
<p>Now define the specifications for the fragment. In this list we are
passing along the syntax and data from above.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fragment.1.specs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Working Memory Measurement Model"</span>,</span>
<span>  model.syntax <span class="op">=</span> <span class="va">Mplus.MODEL.syntax.fragment.1</span>,</span>
<span>  conditioning <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  to.fit <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  estimating.lvs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  priors.syntax <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data.for.mplus</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="specify-fragment-2">Specify Fragment 2<a class="anchor" aria-label="anchor" href="#specify-fragment-2"></a>
</h2>
<p>Fragment 2 is a factor analytic measurement model, similar to
Fragment 1. Here again, the key specification is the Mplus syntax for
the factor analytic measurement model, where as above, the means and
variances for the (2) latent variables are fixed, and the loadings are
estimated.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Mplus.MODEL.syntax.fragment.2</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">    ! Word Learning Factor Model</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Phonological</span></span>
<span><span class="st">  PHON BY</span></span>
<span><span class="st">  ICPVL1gm* ICPVL2gm DIPVL1gm DIPVL2gm</span></span>
<span><span class="st">  SIPVL1gm SIPVL2gm LTPVL1gm LTPVL2gm ICNT2P ICNT1P</span></span>
<span><span class="st">  DINT1P DINT2P PINTGM</span></span>
<span><span class="st">  PIPVLgm;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Semantic</span></span>
<span><span class="st">  SEM BY ICVDD2ap* SIVDD1ap SIVDD2ap PIVDD0ap PIVFRgmp</span></span>
<span><span class="st">  ICVDD1ap SIVFR1gm SIVFR2gm LTVFR1gm LTVFR2gm;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Factor Variances</span></span>
<span><span class="st">  PHON@1;</span></span>
<span><span class="st">  SEM@1;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Factor Correlations</span></span>
<span><span class="st">  PHON WITH SEM;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Factor Means</span></span>
<span><span class="st">  [PHON@0];</span></span>
<span><span class="st">  [SEM@0];</span></span>
<span><span class="st">  "</span></span></code></pre></div>
<p>Now define the specifications for the fragment. In this list we are
passing along the syntax and data from above. Note that even though this
is Fragment 2, it is not conditional on Fragment 1. This is expressed by
the argument that <code>conditioning = 0</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fragment.2.specs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Word Learning Measurement Model"</span>,</span>
<span>  model.syntax <span class="op">=</span> <span class="va">Mplus.MODEL.syntax.fragment.2</span>,</span>
<span>  conditioning <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  to.fit <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  estimating.lvs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  priors.syntax <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data.for.mplus</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="specify-fragment-3">Specify Fragment 3<a class="anchor" aria-label="anchor" href="#specify-fragment-3"></a>
</h2>
<p>Fragment 3 is conditional on Fragment 2, and adds to it by including
additional variables as indicators for one of the latent variables. Note
that the syntax here also includes the specifications fixing the latent
variable means and variances. These were included in Fragment 1 as well,
but also need to be here to preserve this constraint. In effect, the
function will bring in the results for the <em>fitted</em> parameters
from Fragment 2. But the latent variable means and variances were not
fitted parameters in Fragment 2. They were fixed in Fragment 2. So they
will not be “brought forward” by looking at the fitted results from
Fragment 2. So they need to be specified here as well.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Mplus.MODEL.syntax.fragment.3</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">  ! Word Learning Factor Model</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Phonological</span></span>
<span><span class="st">  PHON BY PIMD0ap* ICMD2ap ICMD1ap DIMD1ap  DIMD2ap;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Factor Variances</span></span>
<span><span class="st">  PHON@1;</span></span>
<span><span class="st">  SEM@1;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Factor Means</span></span>
<span><span class="st">  [PHON@0];</span></span>
<span><span class="st">  [SEM@0];</span></span>
<span><span class="st">  "</span></span></code></pre></div>
<p>Now define the specifications for the fragment. In this list we are
passing along the syntax and data, as we did for other fragments. By
setting <code>conditioning = 2</code> in this list of specifications, we
are instructing the functions to condition on the results from Fragment
2.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fragment.3.specs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Including More Word Learning Indicators"</span>,</span>
<span>  model.syntax <span class="op">=</span> <span class="va">Mplus.MODEL.syntax.fragment.3</span>,</span>
<span>  conditioning <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  to.fit <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  estimating.lvs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  priors.syntax <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data.for.mplus</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="specify-fragment-4">Specify Fragment 4<a class="anchor" aria-label="anchor" href="#specify-fragment-4"></a>
</h2>
<p>Fragment 4 contains the structural portion relating the latent
variables from Fragment 1 to those in Fragment 3 (which were also a part
of Fragment 2). The latent variables from Fragment 1 are were exogenous
in that fragment, and remain so here. Accordingly, in the Mplus syntax
their factor means and variances are fixed, as they were in Fragment 1.
In contrast, the latent variables from Fragment 3 were exogenous in
Fragment 3, but are now endogenous (being predicted by the latent
variables from Fragment 1). Accordingly, Even though their means and
variances were fixed in Fragment 3, those parameters are now functions
of other parameters, and we estimate intercepts and latent disturbance
variances for those latent variables as part of the structural model.
Note also that the correlation between the latent disturbances is part
of the fitted model here. This is for the same reason.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Mplus.MODEL.syntax.fragment.4</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Structural relations</span></span>
<span><span class="st">  PHON ON CE FOA PSR;</span></span>
<span><span class="st">  SEM ON CE FOA PSR;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Structural intercepts</span></span>
<span><span class="st">  [PHON];</span></span>
<span><span class="st">  [SEM];</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Latent correlations (disturbances)</span></span>
<span><span class="st">  PHON WITH SEM;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Factor Variances</span></span>
<span><span class="st">  CE@1;</span></span>
<span><span class="st">  FOA@1;</span></span>
<span><span class="st">  PSR@1;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  ! Factor Means</span></span>
<span><span class="st">  [CE@0];</span></span>
<span><span class="st">  [FOA@0];</span></span>
<span><span class="st">  [PSR@0];</span></span>
<span><span class="st">  "</span></span></code></pre></div>
<p>Now define the specifications for the fragment. The first key element
here is <code>conditioning = c(1,2,3)</code>. This communicates that
Fragment 4 is conditional on Fragments 1, 2, and 3. The next key element
here is <code>parameters.to.exclude.in.conditioning</code>. This is a
list with 3 entries, corresponding to the 3 fragments that we are
conditioning on. The entries in the list express which parameters from
that antecedent fragment to ignore (i.e., not carry forward to Fragment
4). In this example, we want to carry forward all the fitted parameters
from Fragment 1, so the first element in the list is <code>none</code>.
But we do want to ignore some of the fitted parameters from Fragment 2
and 3. In particular, we want to ignore the fitted covariances among the
latent variables in those fragments, because those fragments are now
endogenous, and we wish to estimate their latent disturbance covariance,
as mentioned above. .</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fragment.4.specs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Working Memory Predict Word Learning"</span>,</span>
<span>  model.syntax <span class="op">=</span> <span class="va">Mplus.MODEL.syntax.fragment.4</span>,</span>
<span>  conditioning <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>  parameters.to.exclude.in.conditioning <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># fragment 1</span></span>
<span>    <span class="st">"none"</span>,</span>
<span></span>
<span>    <span class="co"># fragment 2</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(co)variances of latent variables"</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="co"># fragment 3</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(co)variances of latent variables"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">)</span>,</span>
<span>  to.fit <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  estimating.lvs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  priors.syntax <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data.for.mplus</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conduct-muppet-modeling">Conduct MUPPET modeling<a class="anchor" aria-label="anchor" href="#conduct-muppet-modeling"></a>
</h2>
<p>The code below demonstrates conducting MUPPET modeling. The
<code>fragments</code> argument contains the specifications for the
model fragments defined above. The rest of the arguments communicate
specifications for running MCMC and saving output. Running this code
will write out output files.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/MUPPET.modular.function.html">MUPPET.modular.function</a></span><span class="op">(</span></span>
<span>    n.chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    n.warmup <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    n.burnin <span class="op">=</span> <span class="fl">500</span>,</span>
<span>    n.iters.per.chain.after.warmup.and.burnin <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    n.estimation.batches <span class="op">=</span> <span class="fl">25</span>,</span>
<span>    convergence.assessment <span class="op">=</span> <span class="st">"unstandardized"</span>,</span>
<span>    save.summary.stats.from.MUPPET<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>    save.summary.plots.from.MUPPET <span class="op">=</span> <span class="st">"unstandardized"</span>,</span>
<span>    save.draws.from.MUPPET<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>    fragments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fragment.1.specs</span>, <span class="va">fragment.2.specs</span>, <span class="va">fragment.3.specs</span>, <span class="va">fragment.4.specs</span><span class="op">)</span>,</span>
<span>    retain.iteration.files <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Roy Levy.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
